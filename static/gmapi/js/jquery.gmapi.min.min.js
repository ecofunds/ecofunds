(function(g){function l(a,b){a=a.split(".");b=""==b?window:b||window.google.maps;if(a[0]in b)return 1<a.length?l(a.slice(1).join("."),b[a[0]]):b[a[0]];throw Error(a[0]+" not found!");}function r(a,b){for(e in b)(function(b,c,f){var g=function(){l(c,window).apply(this,arguments)};f?google.maps.event.addListenerOnce(a,b,g):google.maps.event.addListener(a,b,g)}).apply(this,b[e])}function k(a,b){if("div"===a)return b;if(g.isPlainObject(a)||g.isArray(a)){if(a.cls){"MarkerClusterer"==a.cls&&(a.arg[0]=g(b).getMap(),
a.arg[1]=g(b).getMarkers());var d=[];if(a.arg)for(var c in a.arg)d.push(k(a.arg[c],b));var f,j=l(a.cls,a.context);c=function(){return j.apply(this,d)};c.prototype=j.prototype;f=new c;if(a.nfo){var h=k(a.nfo,b);f.openInfoWindow=function(){f instanceof google.maps.Marker?h.open(f.getMap(),f):h.open(f)};f.closeInfoWindow=function(){h.close()};f.getInfoWindow=function(){return h};f instanceof google.maps.Marker&&(h.getMarker=function(){return f})}a.evt&&r(f,a.evt);return f}if(a.val)return l(a.val);for(var i in a)a[i]=
k(a[i],b)}return a}function i(a){var b=new google.maps.LatLngBounds;if(a instanceof google.maps.MVCArray||g.isArray(a)||g.isPlainObject(a))for(var d in a)b.union(i(a[d]));else a instanceof google.maps.LatLng?b.extend(a):a instanceof google.maps.Marker?b.extend(a.getPosition()):a instanceof google.maps.Polyline?b.union(i(a.getPath())):a instanceof google.maps.Polygon&&b.union(i(a.getPaths()));return b}function m(a){return function(){var b=g(this),d=b.data(a),c;for(c in d)d[c].setMap(null);b.removeData(a)}}
function n(a,b){return function(){if(b){var d=g(this),c=d.data("map"),f=d.data(a)||[],j;for(j in b){var h=k(b[j],this);h.setMap(c);f.push(h)}d.data(a,f)}}}function p(a,b){return function(){var d=g(this),c=d.data("map"),d=d.data(a);c&&d&&(d=i(d),0<=b?(c.setZoom(b),c.setCenter(d.getCenter())):c.fitBounds(d))}}var q=null;g.fn.extend({removeMarkers:function(){return this.each(m("markers"))},removePolylines:function(){return this.each(m("polylines"))},removePolygons:function(){return this.each(m("polygons"))},
addMarkers:function(a){return this.each(n("markers",a))},addPolylines:function(a){return this.each(n("polylines",a))},addPolygons:function(a){return this.each(n("polygons",a))},fitMarkers:function(a){return this.each(p("markers",a))},fitPolylines:function(a){return this.each(p("polylines",a))},fitPolygons:function(a){return this.each(p("polygons",a))},getMarkers:function(){return this.data("markers")},getPolylines:function(){return this.data("polylines")},getCircles:function(){return this.data("circles")},
getPolygons:function(){return this.data("polygons")},getMap:function(){return this.data("map")},applyMap:function(a){var b=[];b.mkr="markers";b.lbl="labels";b.pln="polylines";b.crl="circles";b.pgn="polygons";b.mkc="markersClusterer";return this.each(function(){var d=g(this),c;for(c in b)m(b[c]).call(this);d.removeData("map");var f=k(a,d.children("div")[0]);d.data("map",f);for(c in b)a&&c in a&&(n(b[c],a[c]).call(this),f.getCenter()||p(b[c],f.getZoom()).call(this))})},initMap:function(a,b,d){return this.each(function(){var c=
g(this),f=c.children("div");a||(a="/maps/source/"+c.attr("id").replace("id_",""));null!=q&&q.abort();q=g.ajax({async:!0,data:b,dataType:"json",url:a}).done(function(a){if(a){f.removeClass();c.applyMap(a);var b=c.children("img");google.maps.event.addListenerOnce(c.data("map"),"tilesloaded",function(){b.css("z-index",-1)})}g.isFunction(d)&&d()});f.removeClass();c.applyMap(null)})}})})(jQuery||django.jQuery);